---
title: 聊聊前端缓存
date: 2024-10-13 18:00:27
tags:
- 缓存
- 本地存储
---


## 介绍

前端缓存是一个很大的概念，网上的资料写的都是零零散散的，所以我这里把他们做一个知识串联。

## 分类

按照大类来分可以分为为了资源加载优化的缓存和本地数据存储。
比如：CDN 缓存，浏览器缓存，HTTP缓存。本地数据存储

>**本篇的缓存和本地数据存储是两个不同的概念**
>LocalStorage 并不算缓存，他是前端开发者手动管理的持久性存储，他不参与 HTTP 请求，只在客户端中存储键值对数据，为了存储数据。而浏览器缓存里的本地缓存则是，是浏览器自动管理的资源缓存，为了资源加载优化，保存的是浏览器的静态资源。
>本地数据存储是用于存储应用程序状态和用户数据的理想选择，而缓存更侧重于提升性能和减少网络请求。

## 本地存储

- 用于存储用户数据，生命周期较长，除非主动清除
- 使用 **JavaScript API** 操作

### 分类

localStorage, sessionStorage, cookie, WebSql, indexedDB


## 缓存

- 缓存是由 HTTP 头部（Cache-Control 等）控制，也就是属于 http 缓存
- 通过缓存策略实现自动管理，
- 用于存储静态资源和 API 响应，提升页面性能，但生命周期较短。

Http 缓存分为强缓存和协商缓存，以下的两个缓存都收到 http 设置的影响。

### 浏览器缓存

HTTP 响应头决定了哪些资源应该缓存、缓存多久，以及是否要每次请求都检查资源的更新。浏览器会根据资源的特性和使用场景，自动决定资源是存储在内存缓存（Memory Cache）还是磁盘缓存（Disk Cache）


分为：
- **内存缓存**（Memory Cache）：短时间保存，浏览器关闭后清空。
- **磁盘缓存**（Disk Cache）：长期保存，浏览器重启后仍可使用。
- **Service Worker 缓存**：特殊的缓存，供 PWA 使用。


### CDN 缓存

网页内容分为静态内容和动态内容，就算是静态内容也不是一定用 `CDN`。源服务器在分发内容的时候，会在 ` http ` 响应头增加 ` cache-control `，告诉 `CDN` 哪些要缓存，缓存多久。
但是动态内容，每次 CDN 服务器都要重新向源服务器拿，那这个就没多大的意义了。但是也有解决方案（省略）。

CDN 负载均衡服务器会监控每个 CDN 服务器的负载情况，来平均分配网络的流量，

CDN 的确能提升性能，但缓存有效性、用户访问分布、缓存策略配置都会影响它的效果。简单来说：流量高且集中的站点：CDN 缓存效果非常明显，能够减少大量源站请求。流量小且分散的站点：CDN 的效果有限，某些情况下，访问速度甚至不如直接从源站获取快。合理配置缓存策略、TTL、以及区域缓存同步对于提升 CDN 效果至关重要。


## 浏览器缓存命中执行顺序

1. 是否存在内存缓存？  
   └─ 是 → 使用内存缓存  
   └─ 否 → 2. Service Worker 是否可用？  
       └─ 是 → 使用 Service Worker 缓存  
       └─ 否 → 3. 是否存在磁盘缓存？  
           └─ 是 → 使用磁盘缓存  
            └─ 否 → 从网络或 CDN 获取资源  