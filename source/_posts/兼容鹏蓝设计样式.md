---
title: 兼容鹏蓝设计样式
date: 2024-12-25 21:42:09
tags:
---


## 背景

鹏蓝设计的基础组件样式包，只适配 element ui，原文如下 `theme-roc是基于element ui的Vue项目使用的dmce嵌套结构的scss样式包，前置条件为安装element UI和sass-loader相关依赖；`

由于我是基于vue 3，element plus 开发的项目， element plus 很多样式原来的 element ui 没有，导致页面样式显示不全。


不能做到对这个样式包的开箱即用。需要有一套方案来解决问题。

## 方案一

Element plus 降级为 element ui

- 原文介绍 `element plus 是基于 Vue 3，面向设计师和开发者的组件库`  而 element ui 是基于 vue 2 的包括 vue 2 的生命周期，插槽语法，v-model 在 vue 3 中很难使用，这是技术本身不兼容，
- Element plus 有许多新的属性，组件名称，事件和绑定，修改的话工作量大。
- 语法降级：将原先 V-model 语法糖需要改为 emit 的形式。需要使用到 this，根节点合并，生命周期函数名称更改。

*降级 vue 3*

*工作量*：
- 对 30 多个组件从函数式 api 降级到 Options API ，因为我没有使用 vue 2 的 option api 就导致这里的书写风格是不一样的，都要改。
- vue-router 降级，修改语法。

*学习成本*
- Vue-router降级，options api ， vue 2要学习相应的语法，学习成本高，需要 2周时间。

*组件降级*

![](attachment/Pasted%20image%2020241217103510.png)

用了 30 左右 el 组件，每个组件都需要去官网核对是否需要修改属性，如果使用的属性 el-ui 没有则需要有对应解决方案。


![](attachment/Pasted%20image%2020241217104433.png)
比如 select 通过比对发现在 vue 2 中没有现有的插槽，需要通过别的方式来改造原有代码来保持原有的样式。


## 方案二

加强鹏蓝设计的基础组件样式包，针对个别不兼容的样式，做额外兼容。额外兼容从理论上可以实现，根据页面效果增加类覆盖原有样式。

*工作量*：根据效能开发组的指导，参考鹏蓝设计官网变量对 var. Css 进行变量替换，生成新的 element. Css，第一遍兼容大概需要一周（效能做需要 3 天）。

*与鹏蓝同步更新*：现阶段包括 4 j都是本地更新，用效能的文件来自主替换已有 css，一旦 css 应用完不需要频繁更新，可以长期使用一份文档。

*与Element plus 更新*：如果plus 更新，我也是使用的官方推荐的变量覆盖方法，因为是官方的做法所以不存在兼容性的问题，也就是 plus 升级不能全量覆盖的问题。

*全量替换*：按照官网的方式可以做到对所有组件的全量替换。

*后续开发*：后续效能会针对布局有一次单独开发，这个需要我后续同步跟进，做法和现在一样，到时候用他们的变量来覆盖，我需要负责和 plus 对接。


## 方案对比

方案一

优势：鹏蓝设计自动维护主题

缺点：工作量大，涉及的文件多改动多，可能出现 bug，学习成本大。使用Vue 3 性能好，更加灵活。


方案二

优势：工作量小，代码改动小

缺点：需要自己来实现变量和布局的适配



## 方案二开发流程

在 element-plus 官网下载需要覆盖的文件

![](attachment/Pasted%20image%2020241217105025.png)

参考鹏蓝设计官网变量对默认的 var. Css 进行变量替换，利用编译器生成新的 element. Css 覆盖原有的 element 文件。

第一遍兼容大概需要一周（效能做需要 3 天）。


## 遇到的问题

由于鹏蓝设计样式基于 element ui ，里面的样式的选择器保持了一致，导致优先级是按照 css 引入顺序决定的，vite动态import导致css动态的导入，被添加在script最下面，覆盖了样式怎么办。

可以把鹏蓝的 element 样式覆盖类文件放到 body 里，这样他的优先级永远是最高的。

